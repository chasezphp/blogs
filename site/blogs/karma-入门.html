<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>karma 入门 | 博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="本文介绍了 karma 的入门知识点。">
<meta property="og:type" content="article">
<meta property="og:title" content="karma 入门">
<meta property="og:url" content="http://yibuyisheng.github.io/blogs/site/blogs/karma-入门.html">
<meta property="og:site_name" content="博客">
<meta property="og:description" content="本文介绍了 karma 的入门知识点。">
<meta property="og:updated_time" content="2016-07-01T03:56:25.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="karma 入门">
<meta name="twitter:description" content="本文介绍了 karma 的入门知识点。">
  
    <link rel="alternate" href="/atom.xml" title="博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/blogs/site/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blogs/site/" id="logo">博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/blogs/site/" id="subtitle">偶尔玩玩 Java 的前端工程师</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/blogs/site/">Home</a>
        
          <a class="main-nav-link" href="/blogs/site/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yibuyisheng.github.io/blogs/site"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-karma-入门" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blogs/site/blogs/karma-入门.html" class="article-date">
  <time datetime="2016-07-01T02:35:44.000Z" itemprop="datePublished">2016-07-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      karma 入门
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文介绍了 karma 的入门知识点。<br><a id="more"></a></p>
<h1 id="什么是-karma"><a href="#什么是-karma" class="headerlink" title="什么是 karma"></a>什么是 karma</h1><p>karma 是一个提升测试效率的工具，帮助开发者更好更快速地在多种环境下执行测试代码，拿到测试结果。在运行的时候，它会自动启动配置好的浏览器，同时也会启动一个 node 服务器，然后在启动好的浏览器中执行测试代码，并将测试代码执行结果传回给 node 服务器，然后 node 服务器在打印出收到的执行结果。</p>
<h1 id="安装-karma"><a href="#安装-karma" class="headerlink" title="安装 karma"></a>安装 karma</h1><p>可以通过 npm 安装 karma ：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// 本地安装</div><div class="line">npm i karma --save-dev</div><div class="line"></div><div class="line">// 全局安装</div><div class="line">npm i karma -g</div></pre></td></tr></table></figure>
<h1 id="初始化-karma"><a href="#初始化-karma" class="headerlink" title="初始化 karma"></a>初始化 karma</h1><p>安装完成之后，切换到目标项目根目录，运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">karma init</div></pre></td></tr></table></figure>
<p>这样就会以向导的形式生成 karma 的配置文件 <code>karma.conf.js</code> ，文件内容大致为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Karma configuration</span></div><div class="line"><span class="comment">// Generated on Wed Jun 29 2016 23:22:24 GMT+0800 (CST)</span></div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">config</span>) </span>&#123;</div><div class="line">    config.set(&#123;</div><div class="line"></div><div class="line">        <span class="comment">// 根路径，后面配置的基本所有相对路径都会根据这个路径来构造。</span></div><div class="line">        basePath: <span class="string">''</span>,</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// 使用到的框架</span></div><div class="line">        <span class="comment">// 目前支持的框架： https://npmjs.org/browse/keyword/karma-adapter</span></div><div class="line">        frameworks: [<span class="string">'jasmine'</span>, <span class="string">'requirejs'</span>],</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// 将会在浏览器里面执行的代码</span></div><div class="line">        files: [</div><div class="line">            <span class="string">'test/main.js'</span>,</div><div class="line">            &#123;</div><div class="line">                <span class="attr">pattern</span>: <span class="string">'src/**/*.js'</span>,</div><div class="line">                <span class="comment">// false 表示初始化的时候不会使用 script 标签直接将相关 js 引入到浏览器，需要自己写代码加载</span></div><div class="line">                included: <span class="literal">false</span></div><div class="line">            &#125;,</div><div class="line">            &#123;</div><div class="line">                <span class="attr">pattern</span>: <span class="string">'test/**/*Spec.js'</span>,</div><div class="line">                <span class="attr">included</span>: <span class="literal">false</span></div><div class="line">            &#125;</div><div class="line">        ],</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// 需要从 files 中排除掉的文件</span></div><div class="line">        exclude: [],</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// 需要做预处理的文件，以及这些文件对应的预处理器。</span></div><div class="line">        <span class="comment">// 此处就可以将 coffee 、 ES6 等代码转换一下。</span></div><div class="line">        preprocessors: &#123;</div><div class="line">            <span class="string">'src/**/*.js'</span>: [<span class="string">'babel'</span>, <span class="string">'coverage'</span>],</div><div class="line">            <span class="string">'test/**/!(main).js'</span>: [<span class="string">'babel'</span>, <span class="string">'coverage'</span>],</div><div class="line">            <span class="string">'node_modules/protectobject/src/**/*.js'</span>: [<span class="string">'babel'</span>]</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        <span class="comment">// babel 预处理器的配置</span></div><div class="line">        babelPreprocessor: &#123;</div><div class="line">            <span class="attr">options</span>: &#123;</div><div class="line">                <span class="attr">presets</span>: [<span class="string">'es2015'</span>, <span class="string">'stage-0'</span>],</div><div class="line">                <span class="attr">plugins</span>: [<span class="string">'transform-decorators-legacy'</span>, <span class="string">'transform-es2015-modules-amd'</span>]</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        <span class="comment">// 覆盖率报告器配置</span></div><div class="line">        coverageReporter: &#123;</div><div class="line">            <span class="attr">type</span>: <span class="string">'html'</span>,</div><div class="line">            <span class="attr">dir</span>: <span class="string">'coverage'</span></div><div class="line">        &#125;,</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// 实际使用的报告期</span></div><div class="line">        <span class="comment">// 可用的报告器： https://npmjs.org/browse/keyword/karma-reporter</span></div><div class="line">        reporters: [<span class="string">'dots'</span>, <span class="string">'coverage'</span>],</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// 服务器端口号</span></div><div class="line">        port: <span class="number">9876</span>,</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// 在输出内容（报告器和日志）中启用/禁用颜色</span></div><div class="line">        colors: <span class="literal">true</span>,</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// 日志级别</span></div><div class="line">        <span class="comment">// 取值： config.LOG_DISABLE || config.LOG_ERROR || config.LOG_WARN || config.LOG_INFO || config.LOG_DEBUG</span></div><div class="line">        logLevel: config.LOG_INFO,</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// 启用/禁用监视文件变化重新执行测试的功能</span></div><div class="line">        autoWatch: <span class="literal">true</span>,</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// 要测试的目标环境</span></div><div class="line">        browsers: [<span class="string">'Chrome'</span>, <span class="string">'Firefox'</span>, <span class="string">'Safari'</span>],</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// Continuous Integration mode</span></div><div class="line">        <span class="comment">// if true, Karma captures browsers, runs the tests and exits</span></div><div class="line">        singleRun: <span class="literal">false</span>,</div><div class="line"></div><div class="line">        <span class="comment">// Concurrency level</span></div><div class="line">        <span class="comment">// how many browser should be started simultaneous</span></div><div class="line">        concurrency: <span class="literal">Infinity</span></div><div class="line">    &#125;);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h1 id="配置-Require-js"><a href="#配置-Require-js" class="headerlink" title="配置 Require.js"></a>配置 Require.js</h1><p>对于 Require.js ，还要注意配置一个入口文件，主要用于配置 Require.js 的模块信息等。</p>
<p>上述 karma 配置文件中的 test/main.js 即为 Require.js 的入口文件，在该文件中的代码一般来说应该是这样的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> TEST_REGEXP = <span class="regexp">/(spec|test)\.js$/i</span>;</div><div class="line"><span class="keyword">var</span> allTestFiles = [];</div><div class="line"></div><div class="line"><span class="comment">// Get a list of all the test files to include</span></div><div class="line"><span class="built_in">Object</span>.keys(<span class="built_in">window</span>.__karma__.files).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">file</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (TEST_REGEXP.test(file)) &#123;</div><div class="line">    <span class="comment">// Normalize paths to RequireJS module names.</span></div><div class="line">    <span class="comment">// If you require sub-dependencies of test files to be loaded as-is (requiring file extension)</span></div><div class="line">    <span class="comment">// then do not normalize the paths</span></div><div class="line">    <span class="keyword">var</span> normalizedTestModule = file.replace(<span class="regexp">/^\/base\/|\.js$/g</span>, <span class="string">''</span>);</div><div class="line">    allTestFiles.push(normalizedTestModule);</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">require</span>.config(&#123;</div><div class="line">  <span class="comment">// Karma serves files under /base, which is the basePath from your config file</span></div><div class="line">  baseUrl: <span class="string">'/base/src'</span>,</div><div class="line"></div><div class="line">  <span class="comment">// example of using a couple of path translations (paths), to allow us to refer to different library dependencies, without using relative paths</span></div><div class="line">  paths: &#123;</div><div class="line">    <span class="string">'jquery'</span>: <span class="string">'../lib/jquery'</span>,</div><div class="line">    <span class="string">'underscore'</span>: <span class="string">'../lib/underscore'</span>,</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="comment">// example of using a shim, to load non AMD libraries (such as underscore)</span></div><div class="line">  shim: &#123;</div><div class="line">    <span class="string">'underscore'</span>: &#123;</div><div class="line">      <span class="attr">exports</span>: <span class="string">'_'</span></div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="comment">// dynamically load all test files</span></div><div class="line">  deps: allTestFiles,</div><div class="line"></div><div class="line">  <span class="comment">// we have to kickoff jasmine, as it is asynchronous</span></div><div class="line">  callback: <span class="built_in">window</span>.__karma__.start</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h1 id="执行测试"><a href="#执行测试" class="headerlink" title="执行测试"></a>执行测试</h1><p>运行如下命令，执行测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">karma start</div></pre></td></tr></table></figure>
<h1 id="karma-分析"><a href="#karma-分析" class="headerlink" title="karma 分析"></a>karma 分析</h1><p>在执行测试的时候，点击 <code>debug</code> 按钮，进入 debug 页面，然后打开浏览器开发者工具，可以看到在 HTML 中有一段 js 代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Configure our Karma</span></div><div class="line">    <span class="built_in">window</span>.__karma__.config = &#123;<span class="string">"args"</span>:[],<span class="string">"useIframe"</span>:<span class="literal">true</span>,<span class="string">"captureConsole"</span>:<span class="literal">true</span>,<span class="string">"clearContext"</span>:<span class="literal">true</span>&#125;;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// All served files with the latest timestamps</span></div><div class="line">    <span class="built_in">window</span>.__karma__.files = &#123;</div><div class="line">  <span class="string">'/base/node_modules/requirejs/require.js'</span>: <span class="string">'2c8b45573db27c131094a113e995236d20f043bb'</span>,</div><div class="line">  <span class="string">'/base/node_modules/karma-requirejs/lib/adapter.js'</span>: <span class="string">'2621a4400d4a8a49588243fce2d8609ef950b46a'</span>,</div><div class="line">  <span class="string">'/base/node_modules/jasmine-core/lib/jasmine-core/jasmine.js'</span>: <span class="string">'391e45351df9ee35392d2e5cb623221a969fc009'</span>,</div><div class="line">  <span class="string">'/base/node_modules/karma-jasmine/lib/boot.js'</span>: <span class="string">'945a38bf4e45ad2770eb94868231905a04a0bd3e'</span>,</div><div class="line">  <span class="string">'/base/node_modules/karma-jasmine/lib/adapter.js'</span>: <span class="string">'7975a273517f1eb29d7bd018790fd4c7b9a485d5'</span>,</div><div class="line">  <span class="string">'/base/test/main.js'</span>: <span class="string">'fc5206f4dff3b583db818cb10ed7c5cade572896'</span>,</div><div class="line">  <span class="string">'/base/src/State.js'</span>: <span class="string">'db89a58b4570983b8f8febfd4dedbc586c353670'</span>,</div><div class="line">  <span class="string">'/base/test/StateSpec.js'</span>: <span class="string">'faf31b373690a6d7a7035fdfdc9c85d906ace5c1'</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>可以看到 <code>window.__karma__.files</code> 中列出了所有的可能会在浏览器中执行的 js ，如果通过 Require.js 加载这里没有列举出来的 js ，就会报错。</p>
<p>然后再看下面的一堆 script 标签，大致是这样的：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"/base/node_modules/requirejs/require.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"/base/node_modules/karma-requirejs/lib/adapter.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"/base/node_modules/jasmine-core/lib/jasmine-core/jasmine.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"/base/node_modules/karma-jasmine/lib/boot.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"/base/node_modules/karma-jasmine/lib/adapter.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"/base/test/main.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="built_in">window</span>.__karma__.loaded();</div><div class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>可以看到，直接引入了 require.js 、 karma 相关的一堆 js 、jasmine 相关的 js ，还直接引入了刚才配置的 test/main.js （Require.js 入口文件）。注意，此处并没有直接引入 <code>included: false</code> 的 js 。</p>
<h2 id="URL-路径中的-base"><a href="#URL-路径中的-base" class="headerlink" title="URL 路径中的 base"></a>URL 路径中的 <code>base</code></h2><p>如果仔细看各种资源请求的 URL 地址，会发现除了 <code>debug.js</code> 和 <code>context.js</code> 之外，其它 js 文件都会以 <code>/base</code> 开头，在配置 Require.js 的时候，务必注意这一点。</p>
<h2 id="coverage"><a href="#coverage" class="headerlink" title="coverage"></a>coverage</h2><p>可以引入 karma 的 coverage 插件来查看测试覆盖率，该插件会在目标代码中插入很多额外的代码，用于判断测试代码执行流程有没有走到这些地方。在 debug 的时候，最好关掉 coverage 功能，不然这些额外的代码非常影响调试。</p>
<p>另外 karma-coverage-es6 声称支持 ES6 ，但是似乎并不行？</p>
<h2 id="jasmine-的-HTML-reporter"><a href="#jasmine-的-HTML-reporter" class="headerlink" title="jasmine 的 HTML reporter"></a>jasmine 的 HTML reporter</h2><p>默认情况下，浏览器中 debug 页面是不会输出任何 jamine 测试结果的，可以借助 <code>karma-jasmine-html-reporter</code> 解决这个问题。</p>
<p>但是，<code>karma-jasmine-html-reporter</code> 有坑，在该插件的 index.js 中，有这样一段代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> createPattern = <span class="function"><span class="keyword">function</span>(<span class="params">path</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;<span class="attr">pattern</span>: path, <span class="attr">included</span>: <span class="literal">true</span>, <span class="attr">served</span>: <span class="literal">true</span>, <span class="attr">watched</span>: <span class="literal">false</span>&#125;;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> initReporter = <span class="function"><span class="keyword">function</span>(<span class="params">files,  baseReporterDecorator</span>) </span>&#123;</div><div class="line"></div><div class="line">  baseReporterDecorator(<span class="keyword">this</span>);</div><div class="line"></div><div class="line">  files.unshift(createPattern(__dirname + <span class="string">'/lib/adapter.js'</span>));</div><div class="line">  files.unshift(createPattern(__dirname + <span class="string">'/lib/html.jasmine.reporter.js'</span>));</div><div class="line">  files.unshift(createPattern(__dirname + <span class="string">'/css/jasmine.css'</span>));</div><div class="line">&#125;;</div><div class="line"></div><div class="line">initReporter.$inject = [<span class="string">'config.files'</span>,  <span class="string">'baseReporterDecorator'</span>];</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  <span class="string">'reporter:kjhtml'</span>: [<span class="string">'type'</span>, initReporter]</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p><code>files</code> 指的就是 karma.conf.js 中配置的 files ，此处使用 <code>unshift</code> 方法将这堆 js 、 css 放在了 files 最前面，这样就会导致 <code>html.jasmine.reporter.js</code> 先于 <code>jasmine.js</code> 加载，从而报错（<code>html.jasmine.reporter.js</code> 是要依赖 <code>jasmine.js</code> 的），所以这里最好根据项目的实际情况，合理调整一下顺序。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yibuyisheng.github.io/blogs/site/blogs/site//blogs/karma-入门.html" data-id="ciwqiy02i000r0407idbuqkbl" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/blogs/site/blogs/HTTP请求重发.html" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          HTTP请求重发
        
      </div>
    </a>
  
  
    <a href="/blogs/site/blogs/受保护的对象.html" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">受保护的对象</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/blogs/site/tags/CSS/">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blogs/site/tags/ECMAScript-6/">ECMAScript 6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blogs/site/tags/ETPL/">ETPL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blogs/site/tags/HTTP/">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blogs/site/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blogs/site/tags/Oracle/">Oracle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blogs/site/tags/React/">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blogs/site/tags/Redux/">Redux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blogs/site/tags/Reflux/">Reflux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blogs/site/tags/babel/">babel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blogs/site/tags/markdown/">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blogs/site/tags/vscode/">vscode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blogs/site/tags/数据库/">数据库</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/blogs/site/tags/CSS/" style="font-size: 17.5px;">CSS</a> <a href="/blogs/site/tags/ECMAScript-6/" style="font-size: 15px;">ECMAScript 6</a> <a href="/blogs/site/tags/ETPL/" style="font-size: 12.5px;">ETPL</a> <a href="/blogs/site/tags/HTTP/" style="font-size: 15px;">HTTP</a> <a href="/blogs/site/tags/JavaScript/" style="font-size: 20px;">JavaScript</a> <a href="/blogs/site/tags/Oracle/" style="font-size: 10px;">Oracle</a> <a href="/blogs/site/tags/React/" style="font-size: 10px;">React</a> <a href="/blogs/site/tags/Redux/" style="font-size: 10px;">Redux</a> <a href="/blogs/site/tags/Reflux/" style="font-size: 10px;">Reflux</a> <a href="/blogs/site/tags/babel/" style="font-size: 10px;">babel</a> <a href="/blogs/site/tags/markdown/" style="font-size: 12.5px;">markdown</a> <a href="/blogs/site/tags/vscode/" style="font-size: 10px;">vscode</a> <a href="/blogs/site/tags/数据库/" style="font-size: 10px;">数据库</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blogs/site/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blogs/site/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blogs/site/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blogs/site/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blogs/site/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blogs/site/archives/2015/10/">October 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blogs/site/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blogs/site/archives/2015/08/">August 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blogs/site/archives/2015/07/">July 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blogs/site/archives/2015/06/">June 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blogs/site/archives/2015/05/">May 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blogs/site/archives/2014/10/">October 2014</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blogs/site/blogs/当心，babel 处理 Symbol 的麻烦.html">当心，babel 处理 Symbol 的麻烦</a>
          </li>
        
          <li>
            <a href="/blogs/site/blogs/Redux 使用初探.html">Redux 使用初探</a>
          </li>
        
          <li>
            <a href="/blogs/site/blogs/如何展示表单控件.html">如何展示表单控件</a>
          </li>
        
          <li>
            <a href="/blogs/site/blogs/HTTP请求重发.html">HTTP请求重发</a>
          </li>
        
          <li>
            <a href="/blogs/site/blogs/karma-入门.html">karma 入门</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 yibuyisheng<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/blogs/site/" class="mobile-nav-link">Home</a>
  
    <a href="/blogs/site/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/blogs/site/fancybox/jquery.fancybox.css">
  <script src="/blogs/site/fancybox/jquery.fancybox.pack.js"></script>


<script src="/blogs/site/js/script.js"></script>

  </div>
</body>
</html>